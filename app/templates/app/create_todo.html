{% extends "app/layout.html" %}
{% load static %}

{% block content %}
<form method="post" enctype="multipart/form-data">
  {% csrf_token %}

  {{ todo_form.as_p }}

  <h3>Tasks:</h3>
  <div id="task-formset">
    {{ formset.management_form }}
    {% for form in formset %}
    <div class="task-form">
      {{ form.as_p }}
    </div>
    {% endfor %}
  </div>

  <button type="button" id="add-task">Add Another Task</button>
  <button type="submit">Create Todo</button>
</form>

<section class=" mt-10 min-h-screen flex items-center justify-center px-6 py-8 mx-auto bg-cover bg-center bg-no-repeat">
  <div class="w-full bg-grey-400 p-8 bg-opacity-90">
    <h1 class="text-2xl font-bold text-gray-900 mb-6 text-center">
      Create a Todo
    </h1>

    <div class="grid grid-cols-2 gap-10 m-4 ">
      <div class="border border-black p-8 rounded-xl shadow-xl">
        <form class="space-y-6" method="POST" autocomplete="off" enctype="multipart/form-data">
          {% csrf_token %}

          <div>
            <label for="{{ todo_form.title.id_for_label }}"
              class="block mb-2 text-sm font-medium text-gray-900">Title</label>
            {{ todo_form.title }}
          </div>

          <div>
            <label for="{{ todo_form.description.id_for_label }}"
              class="block mb-2 text-sm font-medium text-gray-900">Description</label>
            {{ todo_form.description }}
          </div>

          <div>
            <label for="{{ todo_form.description.id_for_label }}"
              class="block mb-2 text-sm font-medium text-gray-900">Description</label>
            {{ todo_form.description }}
          </div>

          <div>
            <label for="{{ todo_form.image.id_for_label }}"
              class="block mb-2 text-sm font-medium text-gray-900 dark:text-black">Upload
              file</label>
            {{ todo_form.image }}
            <p class="mt-1 text-sm text-gray-500 dark:text-gray-500" id="file_input_help">SVG, PNG, JPG or GIF (MAX.
              800x400px).</p>
          </div>

          <div>
            <button
              class="flex mt-2 relative inline-flex items-center justify-center p-0.5 mb-2 me-2 overflow-hidden text-sm font-medium text-gray-900 rounded-lg group bg-gradient-to-br from-purple-600 to-blue-500 group-hover:from-purple-600 group-hover:to-blue-500 hover:text-white dark:text-dark focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800">
              <span
                class="relative px-5 py-2.5 transition-all ease-in duration-75 bg-white rounded-md group-hover:bg-transparent">
                Create todo
              </span>
            </button>
          </div>
        </form>
      </div>

      <div id="task-formset">
        {{ formset.management_form }}
        {% for form in formset %}
        <div class="task-form">
          <form class="space-y-6" method="POST" autocomplete="off" enctype="multipart/form-data">
            {% csrf_token %}
            <div>
              <label for="{{ form.title.id_for_label }}" class="block mb-2 text-sm font-medium text-gray-900">Task
                Title</label>
              {{ form.title }}
            </div>
            <div>
              {{ form.completed }}
            </div>
            <div class="flex justify-end">
              <button
                class="flex mt-2 relative inline-flex items-center justify-center p-0.5 mb-2 me-2 overflow-hidden text-sm font-medium text-gray-900 rounded-lg group bg-gradient-to-br from-purple-600 to-blue-500 group-hover:from-purple-600 group-hover:to-blue-500 hover:text-white dark:text-dark focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800">
                <span
                  class="relative px-5 py-2.5 transition-all ease-in duration-75 bg-white rounded-md group-hover:bg-transparent">
                  Add task
                </span>
              </button>
            </div>
          </form>
        </div>
        {% endfor %}
      </div>

    </div>
  </div>
</section>

<script>
  document.getElementById("add-task").addEventListener("click", function () {
    let totalForms = document.querySelector("#id_tasks-TOTAL_FORMS");
    let formCount = Number(totalForms.value);
    let formsetDiv = document.getElementById("task-formset");

    let newForm = formsetDiv.children[formCount].cloneNode(true);
    newForm.innerHTML = newForm.innerHTML.replace(/-0-/g, `-${formCount}-`);

    formsetDiv.appendChild(newForm);
    totalForms.value = formCount + 1;
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
{% endblock content %}
